apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: observability
commonLabels:
  app: jaeger-operator
  version: 2.45.0
helmCharts:
  # - name: jaeger-operator
  #   releaseName: jaegertracing
  #   version: 2.45.0
  #   repo: https://jaegertracing.github.io/helm-charts
  #   includeCRDs: true
  #   namespace: observability
  #   valuesInline:
  #     fullnameOverride: jaeger-operator
  #     rbac:
  #       create: true
  #       clusterRole: true

  - name: jaeger
    releaseName: jaegertracing
    version: 0.71.17
    repo: https://jaegertracing.github.io/helm-charts
    namespace: observability
    valuesInline:
      fullnameOverride: jaeger
      # hotrod:
      #   enabled: true
      commonLabels:
        app: jaeger
        version: 0.71.17
      provisionDataStore:
        cassandra: false
        elasticsearch: true
      storage:
        type: elasticsearch
      collector:
        service:
          zipkin:
            port: 9411
          otlp:
            grpc:
              name: otlp-grpc
              port: 4317
            http:
              name: otlp-http
              port: 4318
      # cassandra:
      # clusterDomain: cluster.local # Just need if cluster is different of cluster.local
      # dbUser:
      #   existingSecret: jaeger-cassandra
      query:
        # cmdlineParams:
        #   - "--metrics-backend=prometheus"
        # - "--prometheus.query.support-spanmetrics-connector=true"
        # - "--prometheus.query.normalize-calls=true"
        # - "--prometheus.query.normalize-duration=true"
        support-spanmetrics-connector: true
        extraEnvVars:
          - name: METRICS_STORAGE_TYPE
            value: prometheus
          - name: PROMETHEUS_SERVER_URL
            value: http://prometheus-server.monitoring.svc
          - name: PROMETHEUS_QUERY_SUPPORT_SPANMETRICS_CONNECTOR
            value: "true"
