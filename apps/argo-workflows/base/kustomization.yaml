apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
helmCharts:
  - name: argo-workflows
    releaseName: argocd-workflows
    namespace: argocd
    version: 0.40.1
    includeCRDs: true
    repo: https://argoproj.github.io/argo-helm
    valuesInline:
      fullnameOverride: argo-workflows
      crds:
        install: true
      controller:
        metrics:
          enabled: true
        logging:
          level: debug
        workflowNamespaces:
          - argocd
      server:
        metrics:
          enabled: true
        logging:
          level: debug
        extraArgs:
          - --auth-mode=sso
          - --insecure-skip-verify=true
        sso:
          enabled: true
          issuer: http://argocd-dex-server.argocd.svc:5556/api/dex
          clientId:
            name: argo-workflows-sso
            key: client-id
          clientSecret:
            name: argo-workflows-sso
            key: client-secret
          redirectUrl: https://argowf.devxp-tech.io/oauth2/callback
          scopes:
            - openid
            - email
            - profile
            - groups
