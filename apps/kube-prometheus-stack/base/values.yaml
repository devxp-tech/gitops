fullnameOverride: prometheus

grafana:
  enabled: false
kubeEtcd:
  enabled: true
kubeControllerManager:
  enabled: true
kubeScheduler:
  enabled: true
kubeProxy:
  enabled: false
defaultRules:
  rules:
    time: false

prometheusOperator:
  resources:
    requests:
      cpu: 50m
      memory: 143M
    limits:
      cpu: 150m
      memory: 1192M
  prometheusConfigReloader:
    resources:
      requests:
        cpu: 200m
        memory: 50Mi
      limits:
        cpu: 400m
        memory: 50Mi

prometheus:
  thanosService:
    enabled: true
  thanosServiceMonitor:
    enabled: true
  prometheusSpec:
    resources:
      requests:
        cpu: 850m
        memory: 2800Mi
      limits:
        cpu: 2000m
        memory: 4000Mi
    replicas: 3
    replicaExternalLabelName: "__replica__"
    externalLabels:
      cluster: lgseksd1
    podAntiAffinity: hard
    ruleSelectorNilUsesHelmValues: false
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    probeSelectorNilUsesHelmValues: false
    retentionSize: "6GB"
    retention: 2d
    walCompression: true
    enableAdminAPI: true
    thanos:
      image: quay.io/thanos/thanos:v0.32.0
      version: "v0.31.0"
      objectStorageConfig:
        name: thanos-objstore-secret
        key: objstore.yml
    # additionalScrapeConfigs:
    #   - job_name: "node-exporter"
    #     honor_timestamps: true
    #     scrape_interval: 1m
    #     scrape_timeout: 10s

alertmanager:
  extraSecretMounts:
    - name: slack-api-url
      mountPath: /etc/secrets/
      secretName: alertmanager-secret
      readOnly: true
  config:
    global:
      resolve_timeout: 5m
      slack_api_url_file: "/etc/secrets/SLACK-TOKEN"
  templates:
    alertmanager.tmpl: |-
      {{/* Alertmanager Silence link */}}
      {{ define "__alert_silence_link" -}}
          {{ .ExternalURL }}/#/silences/new?filter=%7B
          {{- range .CommonLabels.SortedPairs -}}
              {{- if ne .Name "alertname" -}}
                  {{- .Name }}%3D"{{- .Value -}}"%2C%20
              {{- end -}}
          {{- end -}}
          alertname%3D"{{- .CommonLabels.alertname -}}"%7D
      {{- end }}
      {{/* Severity of the alert */}}
      {{ define "__alert_severity" -}}
          {{- if eq .CommonLabels.severity "critical" -}}
          *Severity:* `Critical`
          {{- else if eq .CommonLabels.severity "warning" -}}
          *Severity:* `Warning`
          {{- else if eq .CommonLabels.severity "info" -}}
          *Severity:* `Info`
          {{- else -}}
          *Severity:* :question: {{ .CommonLabels.severity }}
          {{- end }}
      {{- end }}
      {{/* Title of the Slack Team */}}
      {{ define "slack.team" -}}
        [{{ .Status | toUpper -}}
        ] {{ .CommonLabels.team }}
      {{- end }}
      {{/* Title of the Slack alert */}}
      {{ define "slack.title" -}}
        [{{ .Status | toUpper -}}
        {{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{- end -}}
        ] {{ .CommonLabels.alertname }}
      {{- end }}
      {{/* Color of Slack attachment (appears as line next to alert )*/}}
      {{ define "slack.color" -}}
          {{ if eq .Status "firing" -}}
              {{ if eq .CommonLabels.severity "warning" -}}
                  warning
              {{- else if eq .CommonLabels.severity "critical" -}}
                  danger
              {{- else -}}
                  #439FE0
              {{- end -}}
          {{ else -}}
          good
          {{- end }}
      {{- end }}
      {{/* The text to display in the alert */}}
      {{ define "slack.text" -}}
          {{ template "__alert_severity" . }}
          {{- if (index .Alerts 0).Annotations.summary }}
          {{- "\n" -}}
          *Summary:* {{ (index .Alerts 0).Annotations.summary }}
          {{- end }}
          {{ range .Alerts }}
              {{- if .Annotations.description }}
              {{- "\n" -}}
              {{ .Annotations.description }}
              {{- "\n" -}}
              {{- end }}
              {{- if .Annotations.message }}
              {{- "\n" -}}
              {{ .Annotations.message }}
              {{- "\n" -}}
              {{- end }}
          {{- end }}
      {{- end }}

# prometheusOperator:
#   admissionWebhooks:
# certManager:
#   enabled: true
# patch:
#   enabled: true

prometheusOperator:
  admissionWebhooks:
    enabled: false
  tls:
    enabled: false
  tlsProxy:
    enabled: false
  createCustomResource: false

prometheus-node-exporter:
  resources:
    requests:
      cpu: 200m
      memory: 105M
    limits:
      cpu: 400m
      memory: 279M
  fullnameOverride: node-exporter
  prometheus:
    monitor:
      enabled: true
      relabelings:
        - action: replace
          regex: (.*)
          replacement: $1
          sourceLabels:
            - __meta_kubernetes_pod_node_name
          targetLabel: kubernetes_node
        - action: replace
          regex: (.*)
          replacement: $1
          sourceLabels:
            - __meta_kubernetes_pod_node_name
          targetLabel: instance

kubeStateMetrics:
  enabled: true
  resources:
    requests:
      cpu: 15m
      memory: 105M
    limits:
      cpu: 90m
      memory: 407M
