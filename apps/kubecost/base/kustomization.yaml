apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kubecost
helmCharts:
  - name: cost-analyzer
    releaseName: kubecost
    namespace: kubecost
    repo: https://kubecost.github.io/cost-analyzer
    version: 1.105.0
    valuesInline:
      kubecostToken: aGVsbUBrdWJlY29zdC5jb20=xm343yadf98
      persistentVolume:
        storageClass: gp2
      prometheusRule:
        enabled: false
      global:
        grafana:
          enabled: false
          domainName: "grafana.monitoring.svc"
        prometheus:
          enabled: false
          fqdn: http://prometheus-server.monitoring
          # fqdn: kubecost-prometheus-server.kubecost.svc
          nodeExporter:
            enabled: false
          serviceAccounts:
            nodeExporter:
              enabled: false
          kubeStateMetrics:
            enabled: false
          server:
            global:
              external_labels:
                cluster_id: ops-cluster # Each cluster should have a unique ID
      serviceMonitor:
        enabled: true
        # additionalLabels:
        #   label-key: label-value
        networkCosts:
          enabled: true
          # additionalLabels:
          #   label-key: label-value
      oidc:
        enabled: true
        clientID: "kubecost-client" #"client_id" # application/client client_id paramter obtained from provider, used to make requests to server
        # clientSecret: "clientSecret" # application/client client_secret paramter obtained from provider, used to make requests to server
        secretName: "kubecost-secrets" # k8s secret where clientsecret will be stored
        authURL: "https://dex.devxp-tech.io/auth" # endpoint for login to auth server
        loginRedirectURL: "https://kubecost.devxp-tech.io/model/oidc/authorize" # Kubecost url configured in provider for redirect after authentication
        discoveryURL: "https://dex.devxp-tech.io/.well-known/openid-configuration" # url for OIDC endpoint discovery
