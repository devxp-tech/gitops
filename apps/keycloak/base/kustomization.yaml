apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: keycloak
helmCharts:
  - name: keycloak
    releaseName: keycloak
    version: 21.0.3
    includeCRDs: true
    repo: https://charts.bitnami.com/bitnami
    valuesInline:
      namespaceOverride: keycloak
      auth:
        adminUser: admin
        existingSecret: keycloak
      logging:
        level: INFO
      metrics:
        enabled: true
        serviceMonitor:
          enabled: true
      proxyAddressForwarding: true
      proxy: edge
      extraEnvVars:
        - name: PROXY_ADDRESS_FORWARDING
          value: 'true'
        - name: KEYCLOAK_ADMIN
          value: "admin"
        - name: KC_TRANSACTION_XA_ENABLED
          value: "false"
        - name: KC_HOSTNAME_URL
          value: "https://keycloak.devxp-tech.io/auth"
        - name: KC_HOSTNAME_ADMIN_URL
          value: "https://keycloak.devxp-tech.io/auth"
        - name: KC_HOSTNAME_STRICT
          value: "false"
        - name: KC_SPI_STICKY_SESSION_ENCODER_INFINISPAN_SHOULD_ATTACH_ROUTE
          value: "false"
        - name: KC_HTTP_ENABLED
          value: "true"
        - name: KC_HOSTNAME_STRICT_HTTPS
          value: "false"
        - name: KC_HTTP_RELATIVE_PATH
          value: "/auth"
        # - name: KEYCLOAK_ENABLE_HTTPS
        #   value: 'true'
        # - name: KC_PROXY
        #   value: "edge"
        # - name: KC_HOSTNAME_STRICT_HTTPS
        #   value: "false"
      postgresql:
        auth:
          existingSecret: keycloak-postgresql
