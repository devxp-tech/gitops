apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: monitoring
helmCharts:
  - name: loki
    includeCRDs: true
    releaseName: loki
    namespace: monitoring
    version: 5.35.0 #2.9.11
    repo: https://grafana.github.io/helm-charts
    valuesInline:
      labels:
        app: loki
      serviceAccount:
        name: loki
        annotations:
          "eks.amazonaws.com/role-arn": "arn:aws:iam::239468932737:role/loki-lgseksd1-sa"
        automountServiceAccountToken: true

      monitoring:
        lokiCanary:
          enabled: false
        selfMonitoring:
          enabled: false
          grafanaAgent:
            installOperator: false
      test:
        enabled: false

      tracing:
        jaegerAgentHost: jaeger-collector.observability.svc.cluster.local:9411

      persistence:
        enabled: true
      loki:
        auth_enabled: false
        compactor:
          shared_store: aws
        storage:
          bucketNames:
            chunks: "devxp-dev-loki-logs"
            ruler: "devxp-dev-loki-logs"
            admin: "devxp-dev-loki-logs"
          s3:
            region: us-east-1
        schemaConfig:
          configs:
            - from: 2020-10-24
              store: boltdb-shipper
              object_store: aws
              schema: v12
              index:
                prefix: loki_index_
                period: 24h
        storage_config:
          aws:
            s3: "s3://us-east-1/devxp-dev-loki-logs"
          boltdb_shipper:
            shared_store: aws
