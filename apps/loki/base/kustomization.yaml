apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: monitoring
helmCharts:
  - name: loki-stack
    includeCRDs: true
    releaseName: loki-stack
    namespace: monitoring
    version: 2.9.11
    repo: https://grafana.github.io/helm-charts
    valuesInline:
      # nameOverride: loki-stack
      # global:
      #   dnsService: coredns
      #   clusterDomain: cluster.local
      labels:
        app: loki
      loki:
        distributorLabels:
          app: loki
        serviceAccount:
          annotations:
            eks.amazonaws.com/role-arn: "arn:aws:iam::239468932737:role/loki-stack-lgseksd1-sa"
          automountServiceAccountToken: true

        auth_enabled: false

        storage_config:
          boltdb_shipper:
            active_index_directory: /loki/boltdb-shipper-active
            cache_location: /loki/boltdb-shipper-cache
            cache_ttl: 24h # Can be increased for faster performance over longer query periods, uses more disk space
            shared_store: s3
          aws:
            s3: s3://us-east-1
            bucketnames: devxp-dev-loki-logs
            # region: us-east-1
        schema_config:
          configs:
            - from: 2020-07-01
              store: boltdb-shipper
              object_store: aws
              schema: v11
              index:
                prefix: index_
                period: 24h
