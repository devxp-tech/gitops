apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: monitoring
helmCharts:
  - name: loki
    includeCRDs: true
    releaseName: loki
    namespace: monitoring
    version: 5.35.0 #2.9.11
    repo: https://grafana.github.io/helm-charts
    valuesInline:
      # nameOverride: loki-stack
      # global:
      #   dnsService: coredns
      #   clusterDomain: cluster.local
      labels:
        app: loki
      monitoring:
        lokiCanary:
          enabled: true
        selfMonitoring:
          enabled: true
          grafanaAgent:
            installOperator: false
      # persistence:
      #   enabled: true
      loki:
        distributorLabels:
          app: loki
        serviceAccount:
          annotations:
            eks.amazonaws.com/role-arn: "arn:aws:iam::239468932737:role/loki-stack-lgseksd1-sa"
          automountServiceAccountToken: true

        auth_enabled: false

        compactor:
          shared_store: aws
        storage:
          bucketNames: "devxp-dev-loki-logs"
          s3:
            region: us-east-1
        schemaConfig:
          configs:
            - from: "2022-01-11"
              store: boltdb-shipper
              object_store: aws
              schema: v12
              index:
                prefix: loki_index_
                period: 24h
        storage_config:
          aws:
            bucketnames: devxp-dev-loki-logs
            region: us-east-1
            s3forcepathstyle: true
            # endpoint: s3.us-east-1.scw.cloud
            # access_key_id: ${local.scaleway["scw_access_key"]}
            # secret_access_key: ${local.scaleway["scw_secret_key"]}
          boltdb_shipper:
            active_index_directory: /loki/index
            shared_store: s3
            cache_location: /loki/boltdb-cache
