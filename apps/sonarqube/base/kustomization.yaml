apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: sonarqube
resources:
  - ns.yaml
helmCharts:
  - name: sonarqube
    releaseName: sonarqube
    version: 2.0.1
    repo: https://charts.bitnami.com/bitnami
    valuesInline:
      commonLabels:
        app: sonarqube
        version: 9.7.0
      sonarqubeEmail: noreply@devxp-tech.io
      sonarqubeUsername: admin
      existingSecret: sonarqube-postgresql-secret
      # replicaCount: 1
      # minHeapSize: 512m
      # maxHeapSize: 1024m
      sonarqubeSkipInstall: true
      clusterDomain: "lgsk8sp1.grupologos.local"
      persistence:
        enabled: false
      resources:
        requests:
          memory: 1024Mi
          cpu: 200m
        limits:
          memory: 2048Mi
          cpu: 400m
      service:
        type: ClusterIP
      extraEnvVars:
        - name: SONAR_CE_JAVAOPTS
          value: "-Xmx2048m -Xmx2048m"
        - name: JAVA_OPTS
          value: "-Duser.timezone=America/Sao_Paulo -Xmx2048m"
      postgresql:
        auth:
          existingSecret: sonarqube-postgresql-secret
        primary:
          resources:
            limits:
              cpu: 100m
              memory: 256Mi
            requests:
              cpu: 50m
              memory: 128Mi
      # metrics:
      #   jmx:
      #     enabled: true
